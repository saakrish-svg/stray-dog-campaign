<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêï Stop Stray Dog Issues - Sign Now!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            padding: 10px;
            color: #333;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(45deg, #ff4757, #ff3742);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .content {
            padding: 20px;
        }

        .problem-box {
            background: #ffe6e6;
            border-left: 4px solid #ff4757;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .problem-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 14px;
        }

        .problem-item span {
            margin-right: 8px;
            font-size: 16px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn-sign {
            width: 100%;
            background: #27ae60;
            color: white;
            padding: 15px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
        }

        .btn-sign:hover {
            background: #219a52;
        }

        .btn-sign:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .signatures {
            background: #e8f5e8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            text-align: center;
        }

        .signature-count {
            font-size: 2rem;
            font-weight: bold;
            color: #27ae60;
        }

        .signature-list {
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
            text-align: left;
        }

        .signature-item {
            background: white;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 12px;
            border-left: 3px solid #27ae60;
        }

        .share-section {
            background: #e3f2fd;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            text-align: center;
        }

        .btn-share {
            background: #25d366;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            margin: 5px;
            cursor: pointer;
        }

        .btn-report {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            margin: 5px;
            cursor: pointer;
        }

        .progress-bar {
            background: #ddd;
            height: 8px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .progress-fill {
            background: #27ae60;
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .footer {
            background: #2c3e50;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 12px;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 10px;
        }

        .recent-signatures {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 3px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üö® URGENT: Stray Dog Crisis</h1>
            <p>Help Make Our Apartment Safe Again!</p>
        </div>

        <!-- Content -->
        <div class="content">
            <div class="problem-box">
                <h3 style="color: #c0392b; margin-bottom: 10px;">Problems We're Facing:</h3>
                <div class="problem-item">
                    <span>ü©∏</span>
                    <div>Dog fights leaving blood stains in corridors</div>
                </div>
                <div class="problem-item">
                    <span>üöó</span>
                    <div>Scratched cars and damaged property</div>
                </div>
                <div class="problem-item">
                    <span>ü¶†</span>
                    <div>Unhygienic conditions and waste everywhere</div>
                </div>
                <div class="problem-item">
                    <span>üò∞</span>
                    <div>Children and elderly feeling unsafe</div>
                </div>
                <div class="problem-item">
                    <span>üè†</span>
                    <div>Property value declining</div>
                </div>
            </div>

            <!-- Success Message -->
            <div class="success-message" id="successMessage">
                ‚úÖ Thank you for signing! Your signature has been recorded and the page will refresh to show updated count.
            </div>

            <!-- Loading Message -->
            <div class="loading" id="loadingMessage">
                üìù Submitting your signature...
            </div>

            <!-- Signature Form -->
            <div class="form-section">
                <h3 style="margin-bottom: 10px;">üìù Sign the Petition</h3>
                
                <!-- Netlify Form -->
                <form name="stray-dog-petition" method="POST" data-netlify="true" data-netlify-recaptcha="true">
                    <input type="hidden" name="form-name" value="stray-dog-petition">
                    
                    <div class="form-group">
                        <label>Full Name*</label>
                        <input type="text" name="fullName" id="fullName" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label>Flat Number*</label>
                        <input type="text" name="flatNumber" id="flatNumber" placeholder="e.g., A-101" required>
                    </div>
                    <div class="form-group">
                        <label>Mobile Number*</label>
                        <input type="tel" name="mobile" id="mobile" placeholder="Enter mobile number" required>
                    </div>
                    <div class="form-group">
                        <label>Your Main Concern</label>
                        <select name="concern" id="concern">
                            <option value="">Select primary concern</option>
                            <option value="safety">Safety of family members</option>
                            <option value="property">Property damage</option>
                            <option value="hygiene">Cleanliness and hygiene</option>
                            <option value="noise">Noise and disturbance</option>
                            <option value="all">All of the above</option>
                        </select>
                    </div>
                    
                    <!-- Hidden timestamp field -->
                    <input type="hidden" name="timestamp" id="timestamp">
                    
                    <!-- reCAPTCHA -->
                    <div data-netlify-recaptcha="true"></div>
                    
                    <button type="submit" class="btn-sign" id="signButton">‚úçÔ∏è SIGN PETITION NOW</button>
                </form>
            </div>

            <!-- Current Signatures Display -->
            <div class="signatures">
                <div class="signature-count" id="signatureCount">üîÑ</div>
                <div style="font-size: 14px; color: #666;">Residents Have Signed</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div style="font-size: 12px; margin-top: 5px;">Target: 50 signatures</div>
            </div>

            <!-- Recent Signatures Info -->
            <div class="recent-signatures">
                <h4 style="margin-bottom: 8px;">üìã Recent Signatures</h4>
                <p style="font-size: 12px; color: #666;">
                    Signatures are being collected through this form. 
                    After signing, the count will update automatically. 
                    All signatures are stored securely and will be included in the final report.
                </p>
                <p style="font-size: 11px; margin-top: 5px; color: #007bff;">
                    üí° Tip: Refresh the page to see the latest signature count!
                </p>
            </div>

            <!-- Share Section -->
            <div class="share-section">
                <h4>üì¢ Spread the Word!</h4>
                <button class="btn-share" onclick="shareWhatsApp()">üì± Share on WhatsApp</button>
                <button class="btn-report" onclick="viewSubmissions()">üìä View All Signatures</button>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Together we can make our apartment safe and clean! üè°</p>
            <p style="margin-top: 5px; font-size: 10px;">Campaign created for resident welfare</p>
        </div>
    </div>

    <script>
        const targetSignatures = 50;
        let currentCount = 0;
        let usedFlats = new Set();
        let usedMobiles = new Set();

        // Check if user already signed on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('timestamp').value = new Date().toISOString();
            
            // Check if already signed from this device
            if (localStorage.getItem('petitionSigned') === 'true') {
                showAlreadySignedMessage();
                return;
            }
            
            updateDisplayCount();
            loadUsedData();
        });

        function showAlreadySignedMessage() {
            document.getElementById('alreadySignedMessage').style.display = 'block';
            document.querySelector('.form-section').style.display = 'none';
            
            // Still show current count
            updateDisplayCount();
        }

        function loadUsedData() {
            // Load previously used flats and mobiles from localStorage
            const savedFlats = localStorage.getItem('usedFlats');
            const savedMobiles = localStorage.getItem('usedMobiles');
            
            if (savedFlats) {
                usedFlats = new Set(JSON.parse(savedFlats));
            }
            if (savedMobiles) {
                usedMobiles = new Set(JSON.parse(savedMobiles));
            }
        }

        function saveUsedData() {
            localStorage.setItem('usedFlats', JSON.stringify([...usedFlats]));
            localStorage.setItem('usedMobiles', JSON.stringify([...usedMobiles]));
        }

        // Enhanced form validation
        function validateForm(formData) {
            const name = formData.get('fullName').trim();
            const flat = formData.get('flatNumber').trim().toUpperCase();
            const mobile = formData.get('mobile').trim();

            // Basic validation
            if (!name || !flat || !mobile) {
                alert('‚ö†Ô∏è Please fill in all required fields!');
                return false;
            }

            if (mobile.length < 10) {
                alert('‚ö†Ô∏è Please enter a valid mobile number!');
                return false;
            }

            // Check for duplicate flat number
            if (usedFlats.has(flat)) {
                alert(`‚ùå Flat ${flat} has already signed this petition!\n\nIf you believe this is an error, please contact the campaign organizer.`);
                return false;
            }

            // Check for duplicate mobile number
            if (usedMobiles.has(mobile)) {
                alert(`‚ùå This mobile number has already been used to sign!\n\nEach person can only sign once.`);
                return false;
            }

            // Check if already signed from this device
            if (localStorage.getItem('petitionSigned') === 'true') {
                alert('‚ùå You have already signed from this device!\n\nEach person can only sign once.');
                showAlreadySignedMessage();
                return false;
            }

            return true;
        }

        // Handle form submission with duplicate prevention
        document.querySelector('form[name="stray-dog-petition"]').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            // Validate form and check for duplicates
            if (!validateForm(formData)) {
                return;
            }

            const flat = formData.get('flatNumber').trim().toUpperCase();
            const mobile = formData.get('mobile').trim();

            // Show loading
            document.getElementById('loadingMessage').style.display = 'block';
            document.getElementById('signButton').disabled = true;
            document.getElementById('signButton').textContent = 'Submitting...';

            // Submit to Netlify
            fetch('/', {
                method: 'POST',
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: new URLSearchParams(formData).toString()
            })
            .then(() => {
                // Mark as signed on this device
                localStorage.setItem('petitionSigned', 'true');
                localStorage.setItem('signedFlat', flat);
                localStorage.setItem('signedMobile', mobile);
                localStorage.setItem('signedAt', new Date().toISOString());
                
                // Add to used lists
                usedFlats.add(flat);
                usedMobiles.add(mobile);
                saveUsedData();
                
                // Hide loading
                document.getElementById('loadingMessage').style.display = 'none';
                
                // Show success message
                document.getElementById('successMessage').style.display = 'block';
                
                // Hide the form
                document.querySelector('.form-section').style.display = 'none';
                
                // Update count
                currentCount++;
                updateDisplayCount();
                
                // Auto-refresh after 3 seconds to show updated data
                setTimeout(() => {
                    window.location.reload();
                }, 3000);
            })
            .catch((error) => {
                console.error('Error:', error);
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('signButton').disabled = false;
                document.getElementById('signButton').textContent = '‚úçÔ∏è SIGN PETITION NOW';
                alert('‚ùå Error submitting signature. Please try again.');
            });
        });

        function updateDisplayCount() {
            // This is a placeholder count - in a real scenario, you'd fetch from Netlify forms API
            // For now, we'll simulate an increasing count
            const storedCount = localStorage.getItem('simulatedCount') || '0';
            currentCount = parseInt(storedCount);
            
            document.getElementById('signatureCount').textContent = currentCount;
            
            const progressPercent = Math.min((currentCount / targetSignatures) * 100, 100);
            document.getElementById('progressFill').style.width = progressPercent + '%';
        }

        function shareWhatsApp() {
            const currentUrl = window.location.href;
            const message = `üö® URGENT: Help solve stray dog issues in our apartment!

Problems:
ü©∏ Dog fights with blood stains
üöó Property damage  
ü¶† Unhygienic conditions
üò∞ Safety concerns

Current signatures: ${currentCount}/${targetSignatures}

Sign now: ${currentUrl}

‚ö†Ô∏è Only one signature per person allowed
Takes just 30 seconds! üôè

#SafeApartment #ResidentWelfare`;

            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        function viewSubmissions() {
            // Enhanced information about viewing submissions
            const alreadySigned = localStorage.getItem('petitionSigned') === 'true';
            let message = `üìä Total signatures collected: ${currentCount}\n\n`;
            
            if (alreadySigned) {
                const signedFlat = localStorage.getItem('signedFlat');
                const signedAt = localStorage.getItem('signedAt');
                message += `‚úÖ Your signature: Flat ${signedFlat}\n`;
                message += `üìÖ Signed on: ${new Date(signedAt).toLocaleDateString()}\n\n`;
            }
            
            message += `üí° Campaign organizer can view all submissions in Netlify dashboard:\n\n`;
            message += `1. Login to Netlify\n`;
            message += `2. Go to site dashboard\n`;
            message += `3. Click "Forms" tab\n`;
            message += `4. View "stray-dog-petition" submissions\n`;
            message += `5. Export CSV for duplicate checking\n\n`;
            message += `üîí Duplicate prevention: System prevents multiple signatures from same flat/mobile.`;

            alert(message);
        }

        // Add real-time validation for form fields
        document.getElementById('flatNumber').addEventListener('blur', function() {
            const flat = this.value.trim().toUpperCase();
            if (flat && usedFlats.has(flat)) {
                alert(`‚ö†Ô∏è Warning: Flat ${flat} may have already signed. Please verify.`);
                this.style.borderColor = '#e74c3c';
            } else {
                this.style.borderColor = '#ddd';
            }
        });

        document.getElementById('mobile').addEventListener('blur', function() {
            const mobile = this.value.trim();
            if (mobile && usedMobiles.has(mobile)) {
                alert('‚ö†Ô∏è Warning: This mobile number may have already been used.');
                this.style.borderColor = '#e74c3c';
            } else {
                this.style.borderColor = '#ddd';
            }
        });

        // Update stored count when someone signs (for simulation)
        function incrementStoredCount() {
            const current = parseInt(localStorage.getItem('simulatedCount') || '0');
            localStorage.setItem('simulatedCount', (current + 1).toString());
        }
    </script>
</body>
</html>
