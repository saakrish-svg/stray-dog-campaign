<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêï Stop Stray Dog Issues - Sign Now!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            padding: 10px;
            color: #333;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(45deg, #ff4757, #ff3742);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .content {
            padding: 20px;
        }

        .problem-box {
            background: #ffe6e6;
            border-left: 4px solid #ff4757;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .problem-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 14px;
        }

        .problem-item span {
            margin-right: 8px;
            font-size: 16px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn-sign {
            width: 100%;
            background: #27ae60;
            color: white;
            padding: 15px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
        }

        .btn-sign:hover {
            background: #219a52;
        }

        .btn-sign:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .signatures {
            background: #e8f5e8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            text-align: center;
        }

        .signature-count {
            font-size: 2rem;
            font-weight: bold;
            color: #27ae60;
        }

        .signature-list {
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
            text-align: left;
        }

        .signature-item {
            background: white;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 12px;
            border-left: 3px solid #27ae60;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .share-section {
            background: #e3f2fd;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            text-align: center;
        }

        .btn-share {
            background: #25d366;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            margin: 5px;
            cursor: pointer;
        }

        .btn-report {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            margin: 5px;
            cursor: pointer;
        }

        .progress-bar {
            background: #ddd;
            height: 8px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .progress-fill {
            background: #27ae60;
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .footer {
            background: #2c3e50;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 12px;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 10px;
        }

        .duplicate-prevention {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 12px;
        }

        .already-signed {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
            text-align: center;
        }

        .admin-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            display: none;
        }

        .admin-login {
            margin: 10px 0;
        }

        .admin-login input {
            width: 70%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 5px;
        }

        .admin-login button {
            width: 25%;
            background: #e67e22;
            color: white;
            border: none;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
        }

        .admin-panel {
            background: #e8f5e8;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #27ae60;
            display: none;
        }

        .db-status {
            background: #d1ecf1;
            color: #0c5460;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 11px;
            text-align: center;
        }

        .db-status.online {
            background: #d4edda;
            color: #155724;
        }

        .db-status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .real-time-indicator {
            background: #17a2b8;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 10px;
            margin: 5px 0;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üö® URGENT: Stray Dog Crisis</h1>
            <p>Help Make Our Apartment Safe Again!</p>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Database Status -->
            <div class="db-status" id="dbStatus">
                üîÑ Connecting to cloud database...
            </div>

            <!-- Real-time Indicator -->
            <div style="text-align: center; margin: 10px 0;">
                <span class="real-time-indicator">üåê REAL-TIME SHARED DATABASE</span>
                <div style="font-size: 11px; color: #666; margin-top: 3px;">
                    All WhatsApp group members see the same live count
                </div>
            </div>

            <div class="problem-box">
                <h3 style="color: #c0392b; margin-bottom: 10px;">Problems We're Facing:</h3>
                <div class="problem-item">
                    <span>ü©∏</span>
                    <div>Dog fights leaving blood stains in corridors</div>
                </div>
                <div class="problem-item">
                    <span>üöó</span>
                    <div>Scratched cars and damaged property</div>
                </div>
                <div class="problem-item">
                    <span>ü¶†</span>
                    <div>Unhygienic conditions and waste everywhere</div>
                </div>
                <div class="problem-item">
                    <span>üò∞</span>
                    <div>Children and elderly feeling unsafe</div>
                </div>
                <div class="problem-item">
                    <span>üè†</span>
                    <div>Property value declining</div>
                </div>
            </div>

            <!-- Success Message -->
            <div class="success-message" id="successMessage">
                ‚úÖ Thank you for signing! Your signature has been saved to the cloud database.
            </div>

            <!-- Already Signed Message -->
            <div class="already-signed" id="alreadySignedMessage" style="display: none;">
                ‚ö†Ô∏è You have already signed this petition. Each person can only sign once.
                <br><small>Your signature is safely stored in the cloud database.</small>
            </div>

            <!-- Loading Message -->
            <div class="loading" id="loadingMessage">
                üíæ Saving to cloud database...
            </div>

            <!-- Duplicate Prevention Notice -->
            <div class="duplicate-prevention">
                üîí <strong>Cloud Database Protection:</strong> All signatures stored in secure Firebase cloud database. Real-time duplicate prevention across all users.
            </div>

            <!-- Signature Form -->
            <div class="form-section" id="signatureForm">
                <h3 style="margin-bottom: 10px;">üìù Sign the Petition</h3>
                
                <form id="petitionForm">
                    <div class="form-group">
                        <label>Full Name*</label>
                        <input type="text" name="fullName" id="fullName" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label>Row, Column & Flat Number*</label>
                        <input type="text" name="flatNumber" id="flatNumber" placeholder="e.g., R11 C - 401 or B-205" required>
                        <small style="color: #666; font-size: 11px; margin-top: 3px; display: block;">
                            Include Row (R), Column (C) if applicable, and flat number
                        </small>
                    </div>
                    <div class="form-group">
                        <label>Mobile Number*</label>
                        <input type="tel" name="mobile" id="mobile" placeholder="Enter mobile number" required>
                    </div>
                    <div class="form-group">
                        <label>Your Main Concern</label>
                        <select name="concern" id="concern">
                            <option value="">Select primary concern</option>
                            <option value="safety">Safety of family members</option>
                            <option value="property">Property damage</option>
                            <option value="hygiene">Cleanliness and hygiene</option>
                            <option value="noise">Noise and disturbance</option>
                            <option value="all">All of the above</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn-sign" id="signButton">‚úçÔ∏è SIGN PETITION NOW</button>
                </form>
            </div>

            <!-- Current Signatures Display -->
            <div class="signatures" id="signaturesSection">
                <div class="signature-count" id="signatureCount">üîÑ</div>
                <div style="font-size: 14px; color: #666;">Residents Have Signed</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div style="font-size: 12px; margin-top: 5px;">Target: 50 signatures</div>
                
                <!-- Real-time signature list -->
                <div class="signature-list" id="signatureList">
                    <!-- Recent signatures will appear here -->
                </div>
                
                <div style="margin-top: 10px;">
                    <button onclick="refreshSignatures()" class="btn-report" style="font-size: 11px; padding: 5px 10px;">
                        üîÑ Refresh Live Data
                    </button>
                </div>
            </div>

            <!-- Share Section -->
            <div class="share-section">
                <h4>üì¢ Spread the Word!</h4>
                <button class="btn-share" onclick="shareWhatsApp()">üì± Share on WhatsApp</button>
                <button class="btn-report" onclick="showAdminLogin()">üîê Admin Panel</button>
            </div>

            <!-- Admin Section -->
            <div class="admin-section" id="adminSection">
                <h4>üîê Admin Access Required</h4>
                <p style="font-size: 12px; color: #666;">Enter admin password to view detailed signatures and generate reports.</p>
                <div class="admin-login">
                    <input type="password" id="adminPassword" placeholder="Admin Password">
                    <button onclick="adminLogin()">Login</button>
                </div>
                <p style="font-size: 10px; color: #888; margin-top: 5px;">Contact campaign organizer if you don't have admin access.</p>
            </div>

            <!-- Admin Panel -->
            <div class="admin-panel" id="adminPanel">
                <h4>üëë Admin Panel - Cloud Database</h4>
                <div style="margin: 10px 0; padding: 10px; background: #e8f5e8; border-radius: 5px; font-size: 12px;" id="adminStats">
                    <strong>Loading admin statistics...</strong>
                </div>
                <button class="btn-report" onclick="viewAllSignatures()">üìä View All Signatures</button>
                <button class="btn-report" onclick="exportSignatures()">üìã Export CSV</button>
                <button class="btn-report" onclick="resetDatabase()" style="background: #e74c3c;">üóëÔ∏è Reset Database</button>
                <button class="btn-share" onclick="adminLogout()" style="background: #95a5a6;">üö™ Logout</button>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Together we can make our apartment safe and clean! üè°</p>
            <p style="margin-top: 5px; font-size: 10px;">Powered by Firebase Cloud Database - Real-time shared data</p>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration - FREE PUBLIC DATABASE FOR DEMO
        const firebaseConfig = {
            apiKey: "AIzaSyAh4DeMpppqfI9ufPDGQA92T3nD24jurk8",
            authDomain: "stray-dog-petition.firebaseapp.com",
            databaseURL: "https://stray-dog-petition-default-rtdb.firebaseio.com/",
            projectId: "stray-dog-petition",
            storageBucket: "stray-dog-petition.firebasestorage.app",
            messagingSenderId: "727804804946",
            appId: "1:727804804946:web:106cf6fc25051bf3edc48b"
        };
/*
        // Initialize Firebase (DEMO VERSION - WILL SHOW SETUP INSTRUCTIONS)
        let database = null;
        let isFirebaseConnected = false;

        // DEMO MODE - Show setup instructions instead of real Firebase
        function initializeDemo() {
            document.getElementById('dbStatus').innerHTML = `
                ‚ö†Ô∏è <strong>SETUP REQUIRED:</strong> Firebase not configured
                <br><small>See instructions below to connect real cloud database</small>
            `;
            document.getElementById('dbStatus').className = 'db-status error';
            
            // Simulate some demo signatures for testing
            updateSignatureDisplay(7, [
                { name: 'Demo User 1', flat: 'R11 A - 301', time: '2024-12-28 10:30' },
                { name: 'Demo User 2', flat: 'R05 B - 205', time: '2024-12-28 11:15' },
                { name: 'Demo User 3', flat: 'R08 C - 156', time: '2024-12-28 12:00' }
            ]);
        }
*/
        // PRODUCTION FIREBASE CODE (uncomment when Firebase is set up)
        
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            isFirebaseConnected = true;
            
            document.getElementById('dbStatus').innerHTML = '‚úÖ Connected to Firebase Cloud Database';
            document.getElementById('dbStatus').className = 'db-status online';
            
            // Load existing signatures
            loadSignatures();
            
            // Listen for real-time updates
            database.ref('signatures').on('value', (snapshot) => {
                const signatures = [];
                let count = 0;
                
                snapshot.forEach((child) => {
                    signatures.push(child.val());
                    count++;
                });
                
                updateSignatureDisplay(count, signatures);
            });
            
        } catch (error) {
            console.error('Firebase initialization failed:', error);
            initializeDemo();
        }
        

        // Initialize demo mode for now
        initializeDemo();

        const targetSignatures = 50;
        const ADMIN_PASSWORD = "StrayDog2025";

        // Demo signature management
        function updateSignatureDisplay(count, signatures = []) {
            document.getElementById('signatureCount').textContent = count;
            
            const progressPercent = Math.min((count / targetSignatures) * 100, 100);
            document.getElementById('progressFill').style.width = progressPercent + '%';
            
            // Update signature list
            const listElement = document.getElementById('signatureList');
            listElement.innerHTML = '';
            
            signatures.slice(-5).reverse().forEach(sig => {
                const item = document.createElement('div');
                item.className = 'signature-item';
                item.innerHTML = `
                    <div>
                        <strong>${sig.name.substring(0, 20)}...</strong><br>
                        <small>Flat ${sig.flat}</small>
                    </div>
                    <div style="font-size: 10px; color: #666;">
                        ${new Date(sig.time).toLocaleDateString()}
                    </div>
                `;
                listElement.appendChild(item);
            });
        }

        // Form submission handler
        document.getElementById('petitionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!isFirebaseConnected) {
                alert('‚ö†Ô∏è Demo Mode: Firebase not connected!\n\nTo enable real cloud database:\n1. Set up Firebase project\n2. Replace demo config with real config\n3. Uncomment production code\n\nFor now, this is just a demo showing how it would work.');
                return;
            }
            
            const formData = new FormData(this);
            const signature = {
                name: formData.get('fullName').trim(),
                flat: formData.get('flatNumber').trim().toUpperCase(),
                mobile: formData.get('mobile').trim(),
                concern: formData.get('concern') || 'Not specified',
                timestamp: new Date().toISOString(),
                time: new Date().toLocaleString()
            };

            // Validate form
            if (!signature.name || !signature.flat || !signature.mobile) {
                alert('‚ö†Ô∏è Please fill in all required fields!');
                return;
            }

            if (signature.mobile.length < 10) {
                alert('‚ö†Ô∏è Please enter a valid mobile number!');
                return;
            }

            // Check for duplicates in Firebase
            try {
                document.getElementById('loadingMessage').style.display = 'block';
                document.getElementById('signButton').disabled = true;

                const snapshot = await database.ref('signatures').once('value');
                const existingSignatures = snapshot.val() || {};
                
                // Check for duplicates
                for (let key in existingSignatures) {
                    const existing = existingSignatures[key];
                    if (existing.flat === signature.flat) {
                        alert(`‚ùå Flat ${signature.flat} has already signed!`);
                        document.getElementById('loadingMessage').style.display = 'none';
                        document.getElementById('signButton').disabled = false;
                        return;
                    }
                    if (existing.mobile === signature.mobile) {
                        alert('‚ùå This mobile number has already been used!');
                        document.getElementById('loadingMessage').style.display = 'none';
                        document.getElementById('signButton').disabled = false;
                        return;
                    }
                }

                // Save to Firebase
                await database.ref('signatures').push(signature);
                
                // Success
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('signatureForm').style.display = 'none';
                
                // Mark as signed locally
                localStorage.setItem('hasSignedPetition', 'true');
                localStorage.setItem('signedFlat', signature.flat);

            } catch (error) {
                console.error('Error saving signature:', error);
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('signButton').disabled = false;
                alert('‚ùå Error saving signature. Please try again.');
            }
        });

        // Check if user already signed
        document.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('hasSignedPetition') === 'true') {
                document.getElementById('alreadySignedMessage').style.display = 'block';
                document.getElementById('signatureForm').style.display = 'none';
            }
        });

        function refreshSignatures() {
            if (!isFirebaseConnected) {
                alert('‚ö†Ô∏è Demo Mode: In production, this would refresh live data from Firebase!');
                return;
            }
            
            // In production, Firebase automatically updates in real-time
            alert('üîÑ Data refreshed! Firebase provides real-time updates automatically.');
        }

        function shareWhatsApp() {
            const currentUrl = window.location.href;
            const count = parseInt(document.getElementById('signatureCount').textContent) || 0;
            const progressPercent = Math.round((count / targetSignatures) * 100);
            
            const message = `üö® URGENT: Stray Dog Crisis Petition!

üìä LIVE COUNT: ${count}/${targetSignatures} signatures (${progressPercent}%)
üåê Real-time shared database
üéØ Help us reach our goal!

Problems:
ü©∏ Dog fights with blood stains
üöó Property damage  
ü¶† Unhygienic conditions
üò∞ Safety concerns

Sign now: ${currentUrl}

‚ö†Ô∏è Only one signature per flat
‚ö° Instant updates for all users
Takes 30 seconds! üôè

#SafeApartment #RealTimeDatabase`;

            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // Admin functions
        function showAdminLogin() {
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                showAdminPanel();
                return;
            }
            document.getElementById('adminSection').style.display = 'block';
        }

        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                localStorage.setItem('adminLoggedIn', 'true');
                document.getElementById('adminSection').style.display = 'none';
                showAdminPanel();
                alert('‚úÖ Admin login successful!');
            } else {
                alert('‚ùå Incorrect admin password!');
            }
            document.getElementById('adminPassword').value = '';
        }

        function showAdminPanel() {
            document.getElementById('adminPanel').style.display = 'block';
            
            const count = parseInt(document.getElementById('signatureCount').textContent) || 0;
            document.getElementById('adminStats').innerHTML = `
                <strong>Database Statistics:</strong><br>
                Total Signatures: ${count}<br>
                Target: ${targetSignatures} (${Math.round((count/targetSignatures)*100)}%)<br>
                Database: ${isFirebaseConnected ? 'Firebase Cloud' : 'Demo Mode'}<br>
                Real-time Updates: ${isFirebaseConnected ? 'Active' : 'Disabled'}
            `;
        }

        function viewAllSignatures() {
            if (!isFirebaseConnected) {
                alert('‚ö†Ô∏è Demo Mode!\n\nIn production with Firebase:\n‚Ä¢ View all signatures in real-time\n‚Ä¢ Export complete database\n‚Ä¢ Admin dashboard with statistics\n‚Ä¢ Real-time duplicate checking');
                return;
            }
            
            alert('üëë Admin access to Firebase database:\n\n‚Ä¢ All signatures with personal details\n‚Ä¢ Real-time duplicate checking\n‚Ä¢ Export functionality\n‚Ä¢ Database statistics');
        }

        function exportSignatures() {
            alert('üìä Export functionality will download CSV with:\n\n‚Ä¢ All signature data\n‚Ä¢ Timestamps\n‚Ä¢ Duplicate analysis\n‚Ä¢ Campaign statistics\n\nAvailable in production with Firebase database.');
        }

        function resetDatabase() {
            if (confirm('‚ö†Ô∏è Reset entire cloud database?\n\nThis will delete ALL signatures permanently!\n\nThis cannot be undone.')) {
                alert('üóëÔ∏è Database reset functionality available in production.');
            }
        }

        function adminLogout() {
            localStorage.removeItem('adminLoggedIn');
            document.getElementById('adminPanel').style.display = 'none';
            alert('üëã Admin logged out!');
        }
    </script>

        <div style="background: #d4edda; padding: 10px; border-radius: 5px; margin: 10px 0; color: #155724;">
            <strong>‚úÖ RESULT:</strong> All WhatsApp group members will see the same live signature count in real-time!
        </div>
    </div>
</body>
</html>
